# 排气火焰效果研究

视频编辑AI评估的程序化火焰效果研究与实验。

## 问题陈述

视频编辑AI模型在处理火焰/火效果时存在困难，主要问题包括：
- **空间锚定**：效果随时间从附着点漂移
- **时间一致性**：帧间抖动和不稳定
- **物理真实感**：火焰看起来不自然或像计算机生成

本仓库记录了生成逼真排气火焰效果的各种方法，探索什么有效什么无效。

## 探索的方法

| 方法 | 描述 | 质量 | 备注 |
|------|------|------|------|
| [云状翻滚火焰](methods/01_cloud_billowing/) | 湍流云状爆炸 | ⭐⭐⭐⭐ | 最佳整体效果 - 有机、蓬松外观 |
| [向镜头垂直火焰](methods/02_vertical_toward_camera/) | 火焰向观众投射 | ⭐⭐⭐ | 透视正确，已移除火花伪影 |
| [圆形火球](methods/03_fireball_round/) | 简单径向渐变火球 | ⭐⭐⭐ | 干净但过于平滑/人工 |
| [不规则火焰](methods/04_irregular_flames/) | 锯齿状、风吹边缘 | ⭐⭐ | 形状更真实，但难以调节 |
| [Gemini颜色](methods/05_gemini_colors/) | 基于物理的色温 | ⭐⭐⭐ | 颜色准确，已整合到其他方法 |

## 关键技术

### 1. 多八度湍流
在不同尺度（60px、30px、15px、8px）叠加4个噪声八度，配合动画相位偏移，创造有机、翻滚的运动效果。

### 2. 基于温度的颜色渐变
将强度映射到物理准确的火焰颜色：
- 白色核心 (>0.8) - 过曝的最热区域
- 黄色 (0.5-0.8) - 高温可见火焰
- 橙色 (0.2-0.5) - 中等温度
- 红色 (0-0.2) - 较冷边缘

### 3. YOLO车辆跟踪
使用YOLOv8目标检测，配合85/15时间平滑，将火焰锚定到车辆位置。

### 4. 叠加/屏幕混合
火焰添加光线而非替换像素 - 使用叠加或屏幕混合模式。

### 5. 重度辉光
双高斯模糊（81px + 41px内核）创造特征性火焰光晕。

## 环境要求

```bash
pip install opencv-python numpy ultralytics
```

## 使用方法

每个方法文件夹包含：
- `code.py` - 实现代码
- `README.md` - 方法说明
- `outputs/` 中的示例帧

```bash
cd methods/01_cloud_billowing
python code.py
```

## 输出

- `outputs/` - 生成的视频文件
- `comparisons/` - 并排对比视频
- `inputs/` - 原始输入视频

## 模型训练的洞察

1. **空间锚定监督**：模型需要显式的锚点条件
2. **两阶段流水线**：生成效果 → 变形到跟踪位置
3. **物理约束**：火焰效果可能需要超越图像合成的专门模块
4. **时间一致性损失**：惩罚帧间不连续性

## 2D程序化生成的局限性

Gemini Vision一致请求需要3D VFX的功能：
- 流体模拟（Houdini、EmberGen）
- 热扭曲（3D位移）
- 体积渲染
- 光线与表面交互

**结论**：生产级火焰可能需要专门工具或学习的3D表示，而非仅仅2D合成。

## 许可证

MIT - 可自由用于研究和商业用途。
